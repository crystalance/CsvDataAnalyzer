# CSV 数据分析系统 - 运行步骤说明

## 环境要求

- Python 3.10+
- 至少一个 LLM 提供商的 API Key

## 安装

```bash
# 克隆仓库
git clone <repo-url>
cd CsvDataAnalyzer

# 创建虚拟环境
python3 -m venv venv      # 我的python版本是 3.12，经测试，若python3.9及以下将无法成功安装指定版本依赖包而导致报错
source venv/bin/activate  # Windows: .\venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 配置 API Key
cp .env.example .env
# 编辑 .env 文件，填入你的 API Key
```

## 配置

编辑 `.env` 文件：

```bash
# 至少配置其中一个
DASHSCOPE_API_KEY=your_qwen_key      # 通义千问
OPENAI_API_KEY=your_openai_key       # OpenAI
DEEPSEEK_API_KEY=your_deepseek_key   # DeepSeek
```

## 运行应用

```bash
source venv/bin/activate
python app.py
# 浏览器打开 http://localhost:7860
# 特别提醒：Windows 用户请访问 127.0.0.1:7860（而非 0.0.0.0:7860）
```

## 运行测试

```bash
source venv/bin/activate

# 单元测试
python -m unittest tests/test_error_handler.py -v

# 集成测试（错误纠正流程）
python tests/test_error_correction_flow.py --fail-count 2
```

## 在 UI 中测试错误纠正

1. 上传一个 CSV 文件
2. 展开左侧「测试模式」面板
3. 勾选「启用错误注入」
4. 设置失败次数（1-2）
5. 发送任意问题，观察错误纠正过程

## 使用示例

上传销售数据 CSV，尝试以下问题：

```
1. 分析 Clothing 随时间变化的总销售额趋势
2. 对 bikes 进行同样的分析
3. 哪些年份 components 比 accessories 的总销售额高?
4. 哪个产品类别的平均销售额最高？
5. 对比 2022 和 2023 年的销售情况
```
